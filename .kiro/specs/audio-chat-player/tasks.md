# Implementation Plan

- [x] 1. Python仮想環境とDjango プロジェクトのセットアップ
  - Python仮想環境の作成と有効化
  - requirements.txt の作成とDjangoのインストール
  - Django プロジェクトの初期化とアプリケーション作成
  - 基本的なURL設定とビュー構造の準備
  - 静的ファイル配信の設定
  - _Requirements: 4.1, 4.2_

- [x] 2. 音声ファイル管理機能の実装
  - AudioSettings モデルの作成とマイグレーション
  - 固定音声ファイルの配信URL設定
  - 音声ファイル存在確認とエラーハンドリング
  - _Requirements: 4.2, 4.3_

- [x] 3. メインページテンプレートとレイアウトの作成
  - base.html テンプレートの作成
  - audio_player.html メインページテンプレートの作成
  - CSS レイアウト（チャットとプレイヤーの配置）
  - レスポンシブデザインの基本実装
  - _Requirements: 3.1, 3.2, 4.4_

- [x] 4. WaveSurfer.js 音声プレイヤーの基本実装
  - WaveSurfer.js ライブラリの導入と初期化
  - 音声ファイル読み込み機能の実装
  - 基本的な再生コントロール（再生、停止、音量）の実装
  - 波形表示とシーク機能の実装
  - _Requirements: 2.1, 2.2, 2.3, 6.1, 6.2, 6.3, 6.4_

- [ ] 5. Dify チャットボット埋め込み機能の実装
  - iframe を使用したDifyチャットボットの埋め込み
  - 提供されたAPI情報を使用した設定
  - チャットボットとメインページのレイアウト調整
  - _Requirements: 3.1, 3.4, 4.3_

- [ ] 6. 時間範囲抽出機能の実装
  - TimeRangeParser クラスの作成
  - 正規表現を使用した時間範囲パターン [MM:SS-MM:SS] の抽出
  - 時間文字列から秒数への変換機能
  - 複数時間範囲が含まれる場合の最初の範囲選択
  - _Requirements: 5.1, 5.3_

- [ ] 7. iframe 通信機能の実装
  - PostMessage API を使用したiframe通信の設定
  - ChatMessageListener クラスの実装
  - チャット応答メッセージの受信と処理
  - 時間範囲検出時のイベント発火機能
  - _Requirements: 3.4, 5.1, 5.2_

- [ ] 8. WaveSurfer.js リージョン機能の実装
  - WaveSurfer.js regions プラグインの導入
  - RegionController クラスの実装
  - 時間範囲に基づくリージョン作成機能
  - リージョンの視覚的ハイライト表示
  - _Requirements: 1.2, 2.4, 5.2_

- [ ] 9. 範囲再生とループ機能の実装
  - 指定時間範囲での再生制御機能
  - 範囲終了時の自動開始位置復帰
  - ループ再生の開始・停止制御
  - 範囲外クリック時の通常再生モード復帰
  - _Requirements: 1.3, 1.4, 7.1, 7.2, 7.3, 7.5_

- [ ] 10. ドラッグによる範囲調整機能の実装
  - リージョンの境界ドラッグ機能の有効化
  - 開始・終了マーカーの個別調整機能
  - 範囲全体の位置移動機能
  - リアルタイム時間表示の更新
  - _Requirements: 2.5, 2.6, 8.1, 8.2, 8.3, 8.4, 8.5_

- [ ] 11. チャットと音声プレイヤーの統合機能
  - チャット応答から音声プレイヤーへの自動連携
  - 時間範囲設定の自動実行
  - 新しい時間範囲による既存範囲の上書き
  - エラー時のフォールバック処理
  - _Requirements: 1.1, 1.2, 3.3, 5.2, 7.4_

- [ ] 12. エラーハンドリングとバリデーション機能の実装
  - 音声ファイル読み込みエラーの処理
  - 無効な時間範囲フォーマットの検証
  - 音声ファイル長を超える時間の処理
  - iframe通信エラーの検出と処理
  - _Requirements: 5.4_

- [ ] 13. ユニットテストの作成
  - TimeRangeParser のテスト作成
  - AudioSettings モデルのテスト作成
  - JavaScript 関数のテスト作成
  - _Requirements: 4.1, 5.1_

- [ ] 14. 統合テストとE2Eテストの作成
  - WaveSurfer.js 統合テストの作成
  - PostMessage 通信テストの作成
  - ユーザーワークフローのE2Eテスト作成
  - _Requirements: 1.1, 3.4, 5.2_

- [ ] 15. 最終統合とデバッグ
  - 全機能の統合テスト実行
  - ブラウザ互換性の確認
  - パフォーマンス最適化の実施
  - ドキュメント作成とデプロイ準備
  - _Requirements: 4.1, 4.4_